<link rel="stylesheet" type="text/css" href="<?php echo URL ?>public/css/lesson/lesson.css">
<link rel="stylesheet" type="text/css" href="<?php echo URL ?>public/css/common/bootstrap.css">
<link rel="stylesheet" type="text/css" href="<?php echo URL ?>public/js/vendor/tcal/tcal.css">


<?php if ($data['status'] == 'teacher'): ?>
    <nav>
        <button data-bind="changeTab:{tab:'descr',descriptionTab:descriptionTab, homeWork:homeWork}">Описание</button>
        <button data-bind="changeTab:{tab:'tasks',descriptionTab:descriptionTab, homeWork:homeWork}">Решения</button>
    </nav>
<?php endif ?>

<!-- ko if: descriptionTab-->
<section class="main-content clearfix">
    <h2 class="col-lg-7">Домашнее Задание</h2>

    <h3 id="deadLine" class="col-lg-5">Дедлайн: <span data-bind="text:deadLine"></span></h3>

    <div class="col-lg-7"></div>
    <div id="deadLineSettings" class="clearfix col-lg-5">
        <?php if ($data['status'] == 'teacher'): ?>
            <div class="error-deadline" data-bind="if:deadLineError">
                <div data-bind="text:deadLineErrorMessage"></div>
            </div>
            <input data-bind="value: day" placeholder="- -" id="day" type="tel"/>-
            <input data-bind="value: month" placeholder="- -" id="month" type="tel"/>-
            <input data-bind="value: year" placeholder="- - - -" id="year" type="tel"/>
            <input data-bind="value: deadLine" id="calen" class="tcal"/>
            <input data-bind="value: hour" id="hour" placeholder="14" min="0" max="23" type="number"/>:<input
                data-bind="value:minute" id="min" placeholder=" 00" min="0" max="59" type="number"/>
            <button data-bind="setDeadLine{ deadLine:deadLine}">Установить дедлайн</button>
        <?php endif ?>

    </div>

    <section class="col-md-7 clearfix">
        <span
            data-bind="getName:{role:'<?php echo $data['status'] ?>', name:'<?php echo $data['name'] ?>', userId:'<?php echo $data['id'] ?>', userInfo:userInfo}"></span>

        <!-- ko ifnot: descriptionEdit-->
        <?php if ($data['status'] == 'teacher'): ?>
            <div class='description' data-bind="text:homeWorkDescription, click:descriptionEditStart">
                нажмите сюда для редактирования
            </div>
        <?php endif ?>
        <?php if ($data['status'] == 'student'): ?>
            <div class='description' data-bind="text:homeWorkDescription">нажмите сюда для редактирования</div>
        <?php endif ?>
        <!--/ko-->
        <!-- ko if: descriptionEdit-->
        <textarea class="descInput form-control " rows="5"
                  data-bind="value:homeWorkDescription, event: {blur: saveDesc}, hasFocus:true"></textarea>
        <!--/ko-->

    </section>
    <section class="content col-md-5 clearfix ">
        <div class="clearfix">
            <h4>Полезные ссылки:</h4>

            <div>
                <?php if ($data['status'] == 'teacher'): ?>
                    <input type="text" class="col-md-12" placeholder="Вставьте ссылку"
                           data-bind="value:linkToAdd,valueUpdate:'keypress', event: { keypress: saveLink }">

                <?php endif ?>
            </div>
            <div class="col-md-12 clearfix" data-bind="foreach:links">
                <div class="col-lg-12 wordBreak elipsis">
                    <a data-bind="text: nameLink, attr: {href:name}" target="_blank">ссылка</a>
                    <?php if ($data['status'] == 'teacher'): ?>
                        <button class="deleteButton fixes"
                                data-bind="click: function(){$parent.deleteLink($data.name)}">
                            Удалить
                        </button>
                    <?php endif ?>
                </div>
            </div>
        </div>
        <h4>Файлы для скачивания:</h4>
        <?php if ($data['status'] == 'student'): ?>
        <div class='col-md-12 ' data-bind="foreach: files">
            <div class=" col-lg-10">
                <a download="" data-bind="text:newName, attr:{ href:url}">файл</a>
            </div>
            <?php endif ?>

            <?php if ($data['status'] == 'teacher'): ?>
            <div class='col-md-12 ' data-bind="foreach: files">
                <div class=" col-lg-12">
                    <a class="file-link" download="" data-bind="text:oldName, attr:{ href:url}">файл</a>
                    <button class="deleteButton fixes" data-bind="click: function(){$parent.deleteFile($data.newName)}">
                        Удалить
                    </button>
                </div>
                <?php endif ?>
            </div>
            <?php if ($data['status'] == 'teacher'): ?>
                <button data-bind="uploadTask: { files: files, save: makeArray }">Загрузить файл</button>
                <div class="fileValid">Размер не больше 20 мБ</div>
            <?php endif ?>
    </section>
</section>
<!--/ko-->
<section class='main-content'>
    <div>
        <?php if ($data['status'] == 'student'): ?>
            <!-- ko ifnot: deadLinePass-->
            <!-- ko ifnot: selfHomeWork-->
            <h4>Загрузка домашнего задания</h4>
            <button data-bind="uploadHomework{userInfo:userInfo, homeWork:homeWork, id:id} ">Загрузить
                файл
            </button>
            <!--/ko-->
            <!--/ko-->
            <!-- ko if: deadLinePass-->
            <!-- ko ifnot: selfHomeWork-->
            <h4>Загрузка домашнего задания</h4>
            <div><span>Дедлайн прошел. Отправка домашнего задания невозможна</span></div>
            <!--/ko-->
            <!--/ko-->

            <!-- ko if: selfHomeWork-->
            <div data-bind="foreach: homeWork">
                <br><span>Вы уже загрузили домашнее задание</span> <a download=""
                                                                      data-bind="attr:{ href:link}">Скачать</a>
            </div>
            <!--/ko-->

        <?php endif ?>
    </div>
</section>

<!-- ko ifnot: descriptionTab-->
<section class="main-content clearfix ">

    <?php if ($data['status'] == 'teacher'): ?>

        <h4>Присланные решения</h4>

        <table class="table table-striped table-hover ">
            <thead>
            <tr>
                <th>Студент</th>
                <th>Домашнее задание</th>
                <th>Оценка</th>
                <th>Преподаватель</th>
            </tr>
            </thead>
            <tbody data-bind="foreach: homeWork">
            <!-- ko ifnot: grade-->
            <tr class="danger">
                <td data-bind="text:name"></td>
                <td><a download="" data-bind="attr:{ href:link}">Скачать</a></td>
                <td><input type="text" class="col-lg-12"
                           data-bind="value:grade, valueUpdate:'keypress', event: { keypress: $parent.setRate }"></td>
                <td data-bind="text:teacher"></td>
            </tr>
            <!--/ko-->

            <!-- ko if: grade-->
            <tr>
                <td data-bind="text:name"></td>
                <td><a download="" data-bind="attr:{ href:link}">Скачать</a></td>
                <td><input type="text" class="col-lg-12"
                           data-bind="value:grade, valueUpdate:'keypress', event: { keypress: $parent.setRate }"></td>
                <td data-bind="text:teacher"></td>
            </tr>
            <!--/ko-->

            </tbody>
        </table>
    <?php endif ?>
</section>

<!--/ko-->



<script src="<?php print URL; ?>public/js/vendor/jQuery/jquery-2.1.1.js"></script>
<script type="text/javascript" src="<?php echo URL ?>public/js/app/common.js"></script>
<script src="<?php echo URL; ?>public/js/vendor/knockout-3.2.0.js"></script>
<script type="text/javascript" src="<?php echo URL ?>public/js/app/lesson/lesson.js"></script>
<script src="<?php echo URL; ?>public/js/vendor/tcal/tcal.js"></script>
<script>
</script>
